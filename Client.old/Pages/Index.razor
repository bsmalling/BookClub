@page "/"
@using Microsoft.AspNetCore.Authorization
@attribute [Authorize]
@using BookClub.Models
@inject BookClubRestClient bookClubRestClient

<h1>@("Greetings, " + user.FirstName + "!")</h1>

<table>
    <tr>
        <td><b>Next Meeting:</b></td>
        <td>@datetime</td>
    </tr>
    <tr>
        <td><b>Book:</b></td>
        <td>@meeting.Book.Title</td>
    </tr>
    <tr>
        <td><b>Author:</b></td>
        <td>@meeting.Book.Author</td>
    </tr>
    <tr>
        <td><b>Host:</b></td>
        <td>@meeting.Host.FullName</td>
    </tr>
    <tr>
        <td><b>Address:</b></td>
        <td>@meeting.Location.Address1</td>
    </tr>
    @if (meeting.Location.Address2 != null)
    {
        <tr id="address2">
            <td></td>
            <td>@meeting.Location.Address2</td>
        </tr>
    }
    <tr>
        <td><b>City:</b></td>
        <td>@cityStateZip</td>
    </tr>
</table>

@code {
    private User user = null;
    private Meeting meeting = null;
    private string datetime = null;
    private string cityStateZip = null;

    protected override void OnInitialized()
    {
        user = Task.Run(() => bookClubRestClient.GetByIdAsync<User>(BookClubRestClient.UserRoute, 1)).Result;
        meeting = Task.Run(() => bookClubRestClient.GetNextMeetingAsync()).Result;
        datetime = meeting.MeetTime.ToString("dddd, MMMM d, yyyy @ h:mm tt");
        cityStateZip = meeting.Location.City + ", " + meeting.Location.State;
        if (meeting.Location.Zip != null) cityStateZip += "  " + meeting.Location.Zip;
    }
}
